!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.hmpl=e.hmpl||t()}("undefined"!=typeof self?self:this,(function(){return function(){"use strict";const e=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,t=e=>"[object Function]"===Object.prototype.toString.call(e),o=e=>{throw new Error(e)},n=e=>{console.warn(e)},s="method",r="initId",i="after",l="repeat",d="memo",c="indicators",a="autoBody",p="hmpl",f="formData",u="Bad response",h="RequestInit error",m="Render error",y="Request Object error",g="Parse error",b="Compile error",$={formData:!0},v={formData:!1},N=/(\{\{(?:.|\n|\r)*?\}\}|\{\s*\{(?:.|\n|\r)*?\}\s*\})/g,T=/([{}])|([^{}]+)/g,w=["src",s,r,i,l,c,d,a],O=[100,101,102,103,300,301,302,303,304,305,306,307,308,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,425,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511],j=e=>(new DOMParser).parseFromString(`<template>${e}</template>`,"text/html").childNodes[0].childNodes[0].firstChild,P=(t,s,r,i,l,d,c,a,p={},f,y,g)=>{const{mode:b,cache:$,redirect:v,get:N,referrerPolicy:T,signal:w,credentials:O,timeout:P,referrer:E,headers:x,body:k,window:I,integrity:q}=p,C={method:i.toUpperCase()};void 0!==O&&(C.credentials=O),void 0!==k&&(C.body=k),void 0!==b&&(C.mode=b),void 0!==$&&(C.cache=$),void 0!==v&&(C.redirect=v),void 0!==T&&(C.referrerPolicy=T),void 0!==q&&(C.integrity=q),void 0!==E&&(C.referrer=E);const D=void 0!==w;if(D&&(C.signal=w),void 0!==I&&(C.window=I),void 0!==p.keepalive&&n(`${h}: The "keepalive" property is not yet supported`),x)if(e(x)){const e=new Headers;for(const t in x){const n=x[t],s=typeof n;if("string"===s)try{e.set(t,n)}catch(e){throw e}else o(`${h}: Expected type string, but received type ${s}`)}C.headers=e}else o(`${h}: The "headers" property must contain a value object`);P&&(D?n(`${h}: The "signal" property overwrote the AbortSignal from "timeout"`):C.signal=AbortSignal.timeout(P));const R=a&&!d&&r?.memo,A=e=>"rejected"===e||"number"==typeof e&&(e<200||e>299),B=e=>{c&&(y.response=e,N?.("response",e,y)),N?.("response",s)},S=(e,n=!0,s=!1)=>{if(d)f.response=e.cloneNode(!0),N?.("response",e);else{let i=[];const l=(n?e.cloneNode(!0):e).content.childNodes;if(r.nodes){const e=r.parentNode;e||o(`${m}: ParentNode is null`);const t=[],n=r.nodes.length;for(let o=0;o<n;o++){const s=r.nodes[o];if(o===n-1)for(let o=0;o<l.length;o++){const n=l[o],r=e.insertBefore(n,s);t.push(r)}e.removeChild(s)}i=t.slice(),r.nodes=t}else{const e=t.parentNode,o=[];for(let n=0;n<l.length;n++){const s=l[n],r=e.insertBefore(s,t);o.push(r)}e.removeChild(t),i=o.slice(),r.nodes=o,r.parentNode=e}R&&s&&(r.memo.nodes=r.nodes,r.memo.isPending&&(r.memo.isPending=!1)),B(i)}};let M=!1,F=!1;const H=()=>{if(d)f.response=void 0,N?.("response",void 0);else if(r.nodes){const e=r.parentNode;e||o(`${m}: ParentNode is null`);const t=r.nodes.length;for(let o=0;o<t;o++){const n=r.nodes[o];o===t-1&&e.insertBefore(r.comment,n),e.removeChild(n)}r.nodes=null,r.parentNode=null,c&&(y.response=void 0,N?.("response",void 0,y)),N?.("response",s)}R&&null!==r.memo.response&&(r.memo.response=null,delete r.memo.isPending,delete r.memo.nodes)},L=e=>{c?y.status!==e&&(y.status=e,N?.("status",e,y)):f.status!==e&&(f.status=e,N?.("status",e)),R&&A(e)&&(r.memo.response=null,delete r.memo.nodes),(e=>{if(g)if(R&&"pending"!==e&&A(e)&&r.memo.isPending&&(r.memo.isPending=!1),"pending"===e){const e=g.pending;void 0!==e&&(R&&(r.memo.isPending=!0),S(e))}else if("rejected"===e){const e=g.rejected;if(void 0!==e)S(e);else{const e=g.error;void 0!==e?S(e):H()}}else{const t=g[`${e}`];if(e>399)if(M=!0,void 0!==t)S(t);else{const e=g.error;void 0!==e?S(e):H()}else(e<200||e>299)&&(F=!0,void 0!==t?S(t):H())}})(e)};let z=200;L("pending"),fetch(l,C).then((e=>(z=e.status,L(z),e.ok||o(`${u}: Response with status code ${z}`),e.text()))).then((e=>{if(!F)if(A(z))H();else{if(R){const{response:t}=r.memo;if(null===t)r.memo.response=e;else{if(t===e)return void(()=>{if(r.memo.isPending){const e=r.parentNode;e||o(`${m}: ParentNode is null`);const t=r.memo.nodes,n=r.nodes,s=n.length,i=[];for(let o=0;o<s;o++){const r=n[o];if(o===s-1)for(let o=0;o<t.length;o++){const n=t[o],s=e.insertBefore(n,r);i.push(s)}e.removeChild(r)}r.nodes=i.slice(),r.memo.isPending=!1,r.memo.nodes=i.slice()}const e=r.nodes.slice();B(e)})();r.memo.response=e,delete r.memo.nodes}}const n=(e=>{const t=typeof e;"string"!==t&&o(`${u}: Expected type string, but received type ${t}`);const n=j(e),s=n.content,r=s.querySelectorAll("script");for(let e=0;e<r.length;e++){const t=r[e];s.removeChild(t)}return n})(e);if(d)f.response=n,N?.("response",n);else{const e=[],o=n.content.childNodes;if(r)S(n,!1,!0);else{const n=t.parentNode;for(let s=0;s<o.length;s++){const r=o[s],i=n.insertBefore(r,t);c&&e.push(i)}n.removeChild(t),c&&(y.response=e,N?.("response",e,y)),N?.("response",s)}}}})).catch((e=>{throw M||(L("rejected"),g||H()),e}))},E=t=>{const n=e(t);if("boolean"==typeof t||n||o(`${y}: Expected a boolean or object, but got neither`),n)for(const e in t)if(e===f)"boolean"!=typeof t[f]&&o(`${y}: The "${f}" property should be a boolean`);else o(`${y}: Unexpected property "${e}"`)},x=t=>{e(t)?t.hasOwnProperty("id")&&t.hasOwnProperty("value")||o(`${y}: Missing "id" or "value" property`):o(`${y}: IdentificationRequestInit must be of type object`)};return{compile:(n,f={})=>{"string"!=typeof n&&o(`${b}: Template was not found or the type of the passed value is not string`),n||o(`${b}: Template must not be a falsey value`),e(f)||o(`${b}: Options must be an object`);const u=!f.hasOwnProperty(d);u||"boolean"==typeof f[d]||o(`${y}: The value of the property ${d} must be a boolean value`);const k=!f.hasOwnProperty(a);k||E(f[a]);const I=[],q=n.split(N).filter(Boolean),C=[];for(const e of n.matchAll(N))C.push(e.index);0===C.length&&o(`${g}: Request not found`);const D=e=>e=(e=e.trim()).replace(/\r?\n|\r/g,""),R=(e,t)=>{const n=JSON.parse(e);for(const e in n){const t=n[e];switch(w.includes(e)||o(`${y}: Property "${e}" is not processed`),e){case c:Array.isArray(t)||o(`${y}: The value of the property "${e}" must be an array`);break;case r:"string"!=typeof t&&"number"!=typeof t&&o(`${y}: The value of the property "${e}" must be a string`);break;case d:case l:"boolean"!=typeof t&&o(`${y}: The value of the property "${e}" must be a boolean value`);break;case a:E(t);break;default:"string"!=typeof t&&o(`${y}: The value of the property "${e}" must be a string`)}}const s={...n,arrId:t};I.push(s)};let A=0;for(let e=0;e<q.length;e++){const t=q[e];if(C.includes(A)){const n=t.split(T).filter(Boolean);let s=-1,r="",i=!0,l=!1;for(let d=0;d<n.length;d++){const c=n[d],a="}"===c;if("{"===c)i?(i=!1,"{"!==n[d+1]&&d++):r+=c,s++;else if(a){if(-1===s&&o(`${g}: Handling curly braces in the Request Object`),1===s&&(l=!0),0===s){R(r,e),s--,A+=t.length;break}s--,r+=c}else l?D(c)&&o(`${g}: There is no empty space between the curly brackets`):r+=c}if(-1!==s){const n=e+1,i=q[n];void 0===i&&o(`${g}: Handling curly braces in the Request Object`);const d=i.split(T).filter(Boolean);let c="";for(let a=0;a<d.length;a++){const p=d[a],f="{"===p;if("}"===p){if(-1===s&&o(`${g}: Handling curly braces in the Request Object`),1===s&&(l=!0),0===s){const o=[...d];A+=t.length+i.length,o.splice(0,a+1),q[n]=o.join(""),R(r+c,e),s--,e++;break}s--,c+=p}else f?(c+=p,s++):l?D(p)&&o(`${g}: There is no empty space between the curly brackets`):c+=p}}-1!==s&&o(`${g}: Handling curly braces in the Request Object`)}else A+=t.length}0===I.length&&o(`${g}: Request not found`);for(let e=0;e<I.length;e++){const t=I[e],{arrId:o}=t,n=`\x3c!--hmpl${e}--\x3e`;q[o]=n,delete t.arrId}n=q.join("");let B=!1;const S=(e=>{const t=j(e.trim());(t.content.childNodes.length>1||1!==t.content.children.length)&&o(`${m}: Template include only one node with type Element or Comment`);const n=e=>{switch(e.nodeType){case Node.ELEMENT_NODE:if("pre"===e.tagName)return;break;case Node.TEXT_NODE:if(!/\S/.test(e.textContent))return void e.remove()}for(let t=0;t<e.childNodes.length;t++)n(e.childNodes.item(t))};n(t.content.childNodes[0]);let s=t.content.firstElementChild;if(!s){const e=t.content.firstChild,n=8===e?.nodeType;n?(B=n,s=e):o(`${m}: Element is undefined`)}return s})(n);return((n,r,c,f,u,g,b=!1)=>{const N=(n,r)=>{const c=n.src;if(c){const p=(n.method||"GET").toLowerCase();if(!(e=>"get"!==e&&"post"!==e&&"put"!==e&&"delete"!==e&&"patch"!==e)(p)){const s=n.after;s&&b&&o(`${m}: EventTarget is undefined`);const N=!n.hasOwnProperty(l);N||"boolean"==typeof n.repeat||o(`${y}: The "${l}" property has only boolean value`);const T="all"==(N||n.repeat?"all":"one"),w=!n.hasOwnProperty(d);let x=!u&&f.memo;w?x&&(s&&T||(x=!1)):s?n.memo?T?x=!0:o(`${y}: Memoization works in the enabled repetition mode`):x=!1:o(`${y}: Memoization works in the enabled repetition mode`);const k=!n.hasOwnProperty(a);let I=!g&&f.autoBody;if(k)!0===I&&(I=$),s||(I=!1);else if(s){let e=n[a];if(E(e),!0===I&&(I=$),!0===e&&(e=$),!1===e)I=!1;else{const t={...!1===I?v:I,...e};I=t}}else I=!1;const q=n.initId,C=n.nodeId;let D=n.indicators;if(D){const e=e=>{const{trigger:t,content:n}=e;t||o(`${y}: Failed to activate or detect the indicator`),n||o(`${y}: Failed to activate or detect the indicator`),-1===O.indexOf(t)&&"pending"!==t&&"rejected"!==t&&"error"!==t&&o(`${y}: Failed to activate or detect the indicator`);const s=j(n);return{...e,content:s}},t={},n=[];for(let s=0;s<D.length;s++){const r=e(D[s]),{trigger:i}=r;-1===n.indexOf(i)?n.push(i):o(`${y}: Indicator trigger must be unique`),t[`${i}`]=r.content}D=t}const R=(e,t=!1)=>{if(t){if(q){let t;for(let o=0;o<e.length;o++){const n=e[o];if(n.id===q){t=n.value;break}}return t||o(`${y}: ID referenced by request not found`),t}return{}}return q&&o(`${y}: ID referenced by request not found`),e},A=T&&s,B=(n,s,i,l,d,a=!1,f,u=!1,y,g)=>{const $=l.currentId;if(b)n||(n=r);else if(!n)if(y)n=y.el;else{let e;const{els:t}=l;for(let o=0;o<t.length;o++){const n=t[o];if(n.id===C){y=n,e=n.el;break}}e||o(`${m}: The specified DOM element is not valid or cannot be found`),n=e}let v;b||(A||D)&&(y||o(`${m}: The specified DOM element is not valid or cannot be found`),v=y.objNode,v||(v={id:$,nodes:null,parentNode:null,comment:n},x&&(v.memo={response:null},D&&(v.memo.isPending=!1)),y.objNode=v,l.dataObjects.push(v),l.currentId++));let N=R(s,a);const T=t(N);if(!T&&N&&(N={...N}),I&&I.formData&&g&&!T){const{type:e,target:t}=g;"submit"===e&&t&&t instanceof HTMLFormElement&&"FORM"===t.nodeName&&(N.body=new FormData(t,g.submitter))}const w=T?((e,t)=>{const o={};return void 0!==t&&(o.event=t),e({request:o})})(N,g):N;e(w)||void 0===w||o(`${h}: Expected an object with initialization options`),P(n,d,v,p,c,b,u,x,w,i,f,D)};let S=B;if(s){const e=(e,t,n,s,r,i,l,d,c,a,p)=>{const f=c.querySelectorAll(n);0===f.length&&o(`${m}: Selectors nodes not found`);const u=T?t=>{B(e,s,r,i,c,l,a,d,p,t)}:o=>{B(e,s,r,i,c,l,a,d,p,o);for(let e=0;e<f.length;e++)f[e].removeEventListener(t,u)};for(let e=0;e<f.length;e++)f[e].addEventListener(t,u)};if(s.indexOf(":")>0){const t=s.split(":"),o=t[0],n=t.slice(1).join(":");S=(t,s,r,i,l,d=!1,c,a=!1,p)=>{e(t,o,n,s,r,i,d,a,l,c,p)}}else o(`${y}: The "${i}" property doesn't work without EventTargets`)}else N||o(`${y}: The "${l}" property doesn't work without "${i}" property`);return S}o(`${y}: The "${s}" property has only GET, POST, PUT, PATCH or DELETE values`)}else o(`${y}: The "source" property are not found or empty`)};let T;if(b)c[0].el=n,T=N(c[0]);else{let e=-2;const t=n=>{if(e++,8==n.nodeType){let t=n.nodeValue;if(t&&t.startsWith(p)){t=t.slice(4);const s=Number(t),r=c[s];(Number.isNaN(s)||void 0===r)&&o(`${m}: Request object not found`),r.el=n,r.nodeId=e}}if(n.hasChildNodes()){const e=n.childNodes;for(let o=0;o<e.length;o++)t(e[o])}};t(n);const s=[];for(let e=0;e<c.length;e++){const t=c[e];s.push(N(t,n))}if(c.length>1)T=(e,t,n,r,i,l=!1)=>{e||(e=i);const d=[],c=r.els;for(let i=0;i<c.length;i++){const a=c[i],p=a.el;null===p.parentNode&&o(`${m}: ParentNode is null`);const f={response:void 0};(0,s[i])(p,t,n,r,e,l,f,!0,a),d.push(f)}n.requests=d};else{const e=c[0];null===e.el.parentNode&&o(`${m}: ParentNode is null`),T=N(e,n)}}return r(T)})(S,(n=>(s={})=>{const r=S.cloneNode(!0),i={response:B?void 0:r},l={dataObjects:[],els:[],currentId:0};if(!B){let e=-2;const t=o=>{if(e++,8==o.nodeType){const t=o.nodeValue;if(t&&t.startsWith(p)){const t={el:o,id:e};l.els.push(t)}}if(o.hasChildNodes()){const e=o.childNodes;for(let o=0;o<e.length;o++)t(e[o])}};t(r)}return e(s)||t(s)?((n=>{const s=e(n);s||t(n)||void 0===n||o(`${h}: Expected an object with initialization options`),s&&n.get&&(t(n.get)||o(`${h}: The "get" property has a function value`))})(s),n(void 0,s,i,l,r)):Array.isArray(s)&&((t=>{const n=[];for(let s=0;s<t.length;s++){const r=t[s];e(r)||o(`${y}: Options is of type object`),x(r);const{id:i}=r;"string"!=typeof r.id&&"number"!=typeof r.id&&o(`${y}: ID must be a string or a number`),n.indexOf(i)>-1?o(`${y}: ID with value "${i}" already exists`):n.push(i)}})(s),n(void 0,s,i,l,r,!0)),i}),I,f,u,k,B)},stringify:e=>JSON.stringify(e)}}()}));